/*! @file
********************************************************************************
<PRE>
模块名       : 硬件驱动模块
文件名       : drvI2C.h
相关文件     : 
文件实现功能 : I2C总线驱动
作者         : <--->
版本         : 1.0
--------------------------------------------------------------------------------
备注         : 
--------------------------------------------------------------------------------
修改记录 : 
日 期        版本   修改人         修改内容 
2010/10/05   1.0    <xxxx>         创建
</PRE>
********************************************************************************

  * 版权所有(c) YYYY, <xxx>, 保留所有权利
  
*******************************************************************************/

/* Includes ------------------------------------------------------------------*/
#include "drvI2C.h"

/* Private typedef -----------------------------------------------------------*/

/* Private define ------------------------------------------------------------*/

/* Private macro -------------------------------------------------------------*/

/* Private variables ---------------------------------------------------------*/

/* Private function prototypes -----------------------------------------------*/

/* Private functions ---------------------------------------------------------*/

/****************************************************************************************
** 函数名称: EE_I2C_delay
** 功能描述: 延时
** 参    数: None
** 返 回 值: None       
** 作　  者: 
** 日  　期: 2009年10月14日
**---------------------------------------------------------------------------------------
** 修 改 人: 
** 日　  期: 
**--------------------------------------------------------------------------------------
****************************************************************************************/
void EE_I2C_delay(void) 
{ 
   u8 i = 30; //这里可以优化速度
   while(i)  
   {  
     i--;  
   }
}
/****************************************************************************************
** 函数名称: EE_I2C_Start
** 功能描述: 启动
** 参    数: None
** 返 回 值: u8       
** 作　  者: 
** 日  　期: 2009年10月14日
**---------------------------------------------------------------------------------------
** 修 改 人: 
** 日　  期: 
**--------------------------------------------------------------------------------------
****************************************************************************************/
u8 EE_I2C_Start(void) 
{ 
    EE_SDA_H; 
    EE_SCL_H; 
    EE_I2C_delay(); 
    if(!EE_SDA_READ)
    {
        return FALSE; //SDA线为低电平则总线忙,退出 
    }
    EE_SDA_L; 
    EE_I2C_delay(); 
    if(EE_SDA_READ)
    {
        return FALSE; //SDA线为高电平则总线出错,退出 
    }
    EE_SCL_L; 
    EE_I2C_delay(); 
    return TRUE; 
}
/****************************************************************************************
** 函数名称: EE_I2C_Stop
** 功能描述: 停止
** 参    数: None
** 返 回 值: None       
** 作　  者: 
** 日  　期: 2009年10月14日
**---------------------------------------------------------------------------------------
** 修 改 人: 
** 日　  期: 
**--------------------------------------------------------------------------------------
****************************************************************************************/
void EE_I2C_Stop(void) 
{ 
    EE_SCL_L; 
    EE_I2C_delay(); 
    EE_SDA_L; 
    EE_I2C_delay(); 
    EE_SCL_H; 
    EE_I2C_delay(); 
    EE_SDA_H; 
    EE_I2C_delay(); 
}  
/****************************************************************************************
** 函数名称: EE_I2C_Ack
** 功能描述: 应答
** 参    数: None
** 返 回 值: None       
** 作　  者: 
** 日  　期: 2009年10月14日
**---------------------------------------------------------------------------------------
** 修 改 人: 
** 日　  期: 
**--------------------------------------------------------------------------------------
****************************************************************************************/
void EE_I2C_Ack(void) 
{ 
    EE_SCL_L; 
    EE_I2C_delay(); 
    EE_SDA_L; 
    EE_I2C_delay(); 
    EE_SCL_H; 
    EE_I2C_delay(); 
    EE_SCL_L; 
    EE_I2C_delay(); 
} 
/****************************************************************************************
** 函数名称: EE_I2C_NoAck
** 功能描述: 无应答
** 参    数: None
** 返 回 值: None       
** 作　  者: 
** 日  　期: 2009年10月14日
**---------------------------------------------------------------------------------------
** 修 改 人: 
** 日　  期: 
**--------------------------------------------------------------------------------------
****************************************************************************************/
void EE_I2C_NoAck(void) 
{ 
    EE_SCL_L; 
    EE_I2C_delay(); 
    EE_SDA_H; 
    EE_I2C_delay(); 
    EE_SCL_H; 
    EE_I2C_delay(); 
    EE_SCL_L; 
    EE_I2C_delay(); 
} 
/****************************************************************************************
** 函数名称: EE_I2C_WaitAck
** 功能描述: 等待有无应答
** 参    数: None
** 返 回 值: =1有ACK,=0无ACK   
** 作　  者: 
** 日  　期: 2009年10月14日
**---------------------------------------------------------------------------------------
** 修 改 人: 
** 日　  期: 
**--------------------------------------------------------------------------------------
****************************************************************************************/
u8 EE_I2C_WaitAck(void)   
{ 
    EE_SCL_L; 
    EE_I2C_delay(); 
    EE_SDA_H; 
    EE_I2C_delay(); 
    EE_SCL_H; 
    EE_I2C_delay(); 
    if(EE_SDA_READ) 
    { 
        EE_SCL_L; 
        return FALSE; 
    } 
    EE_SCL_L; 
    return TRUE; 
} 
/****************************************************************************************
** 函数名称: EE_I2C_SendByte
** 功能描述: 数据从高位到低位发送
** 参    数: u8 SendByte-发送的数据
** 返 回 值: None   
** 作　  者: 
** 日  　期: 2009年10月14日
**---------------------------------------------------------------------------------------
** 修 改 人: 
** 日　  期: 
**--------------------------------------------------------------------------------------
****************************************************************************************/
void EE_I2C_SendByte(u8 SendByte)
{ 
    u8 i=8; 
    while(i--) 
    { 
        if(SendByte&0x80) 
        {
            EE_SDA_H;
        }
        else
        {
            EE_SDA_L;
        }             
        EE_SCL_H;                                                        
        SendByte<<=1; 
        EE_I2C_delay(); 
        EE_SCL_L; 
        EE_I2C_delay(); 
    } 
    EE_SCL_L; 
} 

/****************************************************************************************
** 函数名称: EE_I2C_ReceiveByte
** 功能描述: 数据从高位到低位接收
** 参    数: None
** 返 回 值: =接收的数据   
** 作　  者: 
** 日  　期: 2009年10月14日
**---------------------------------------------------------------------------------------
** 修 改 人: 
** 日　  期: 
**--------------------------------------------------------------------------------------
****************************************************************************************/
u8 EE_I2C_ReceiveByte(void)  //数据从高位到低位// 
{  
    u8 i=8; 
    u8 ReceiveByte=0; 

    EE_SDA_H; 
    while(i--) 
    { 
        ReceiveByte<<=1;       
        EE_SCL_L; 
        EE_I2C_delay(); 
        EE_SCL_H; 
        EE_I2C_delay(); 
        if(EE_SDA_READ) 
        { 
            ReceiveByte|=0x01; 
        } 
    } 
    EE_SCL_L; 
    return ReceiveByte; 
} 

